Content is user-generated and unverified.
1
<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="å°è‚¡å¤§ç›¤ K å€¼å³æ™‚ç›£æ§ï¼Œæ™ºèƒ½è­¦å ±é€šçŸ¥">
    <meta name="theme-color" content="#2563eb">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="å°è‚¡ç›£æ§">
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect fill='%232563eb' width='100' height='100'/><text y='70' x='50' text-anchor='middle' font-size='60' fill='white'>ğŸ“Š</text></svg>">
    <link rel="manifest" href="manifest.json">
    <title>å°è‚¡ K å€¼ç›£æ§</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/recharts@2.5.0/dist/Recharts.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        body { margin: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; }
        * { -webkit-tap-highlight-color: transparent; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;
        const { LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, ReferenceLine } = Recharts;

        function App() {
            const [currentK, setCurrentK] = useState(null);
            const [historicalData, setHistoricalData] = useState([]);
            const [lastUpdate, setLastUpdate] = useState(new Date());
            const [notifications, setNotifications] = useState([]);
            const [loading, setLoading] = useState(true);
            const [dataSource, setDataSource] = useState('');
            const [isIOS, setIsIOS] = useState(false);
            const [showInstallPrompt, setShowInstallPrompt] = useState(true);

            useEffect(() => {
                const isIOSDevice = /iPad|iPhone|iPod/.test(navigator.userAgent);
                const isStandalone = window.navigator.standalone === true;
                setIsIOS(isIOSDevice && !isStandalone);
            }, []);

            const calculateKValue = (prices, period = 9) => {
                if (prices.length < period) return null;
                const recentPrices = prices.slice(-period);
                const high = Math.max(...recentPrices.map(p => p.high));
                const low = Math.min(...recentPrices.map(p => p.low));
                const close = recentPrices[recentPrices.length - 1].close;
                if (high === low) return 50;
                const rsv = ((close - low) / (high - low)) * 100;
                return Math.round(rsv);
            };

            const generateMockData = () => {
                const data = [];
                const basePrice = 22500;
                const today = new Date();
                
                for (let i = 29; i >= 0; i--) {
                    const date = new Date(today);
                    date.setDate(date.getDate() - i);
                    date.setHours(13, 30, 0, 0);
                    
                    const trend = Math.sin(i / 5) * 500;
                    const randomFactor = (Math.random() - 0.5) * 300;
                    const close = basePrice + trend + randomFactor;
                    const high = close + Math.random() * 200;
                    const low = close - Math.random() * 200;
                    const open = low + Math.random() * (high - low);
                    
                    data.push({ date, open, high, low, close });
                }
                
                return { success: true, data, source: 'æ¨¡æ“¬æ•¸æ“šï¼ˆç¤ºç¯„ç‰ˆæœ¬ï¼‰' };
            };

            const fetchYahooData = async () => {
                try {
                    const symbol = '^TWII';
                    const end = Math.floor(Date.now() / 1000);
                    const start = end - (30 * 24 * 60 * 60);
                    const url = `https://query1.finance.yahoo.com/v8/finance/chart/${symbol}?period1=${start}&period2=${end}&interval=1d`;
                    
                    const response = await fetch(url);
                    const data = await response.json();
                    
                    if (data.chart?.result?.[0]) {
                        const result = data.chart.result[0];
                        const quotes = result.indicators.quote[0];
                        const timestamps = result.timestamp;
                        
                        const historicalPrices = timestamps.map((ts, i) => ({
                            date: new Date(ts * 1000),
                            open: quotes.open[i],
                            high: quotes.high[i],
                            low: quotes.low[i],
                            close: quotes.close[i]
                        })).filter(p => p.close !== null);
                        
                        if (historicalPrices.length > 0) {
                            return { success: true, data: historicalPrices, source: 'Yahoo Finance å³æ™‚æ•¸æ“š' };
                        }
                    }
                    return { success: false };
                } catch (error) {
                    console.log('Yahoo API ç„¡æ³•é€£æ¥ï¼Œä½¿ç”¨æ¨¡æ“¬æ•¸æ“š');
                    return { success: false };
                }
            };

            const fetchDataAndCalculateK = async () => {
                setLoading(true);
                
                try {
                    let result = await fetchYahooData();
                    
                    if (!result.success) {
                        result = generateMockData();
                    }
                    
                    setDataSource(result.source);
                    const prices = result.data;
                    const last10Days = prices.slice(-10);
                    
                    const historicalKData = last10Days.map((price, index) => {
                        const dataForCalc = prices.slice(0, prices.length - 10 + index + 1);
                        const kValue = calculateKValue(dataForCalc);
                        
                        return {
                            date: `${price.date.getMonth() + 1}/${price.date.getDate()}`,
                            fullDate: price.date.toLocaleDateString('zh-TW'),
                            kValue: kValue || 50,
                            price: Math.round(price.close)
                        };
                    });
                    
                    setHistoricalData(historicalKData);
                    const latestK = historicalKData[historicalKData.length - 1].kValue;
                    setCurrentK(latestK);
                    checkAndNotify(latestK);
                    setLastUpdate(new Date());
                } catch (err) {
                    console.error('éŒ¯èª¤:', err);
                    const mockResult = generateMockData();
                    setDataSource(mockResult.source);
                    const prices = mockResult.data;
                    const last10Days = prices.slice(-10);
                    
                    const historicalKData = last10Days.map((price, index) => {
                        const dataForCalc = prices.slice(0, prices.length - 10 + index + 1);
                        const kValue = calculateKValue(dataForCalc);
                        return {
                            date: `${price.date.getMonth() + 1}/${price.date.getDate()}`,
                            fullDate: price.date.toLocaleDateString('zh-TW'),
                            kValue: kValue || 50,
                            price: Math.round(price.close)
                        };
                    });
                    
                    setHistoricalData(historicalKData);
                    setCurrentK(historicalKData[historicalKData.length - 1].kValue);
                } finally {
                    setLoading(false);
                }
            };

            const checkAndNotify = (kValue) => {
                const now = new Date();
                const timeStr = now.toLocaleTimeString('zh-TW', { hour: '2-digit', minute: '2-digit' });
                
                if (kValue >= 85) {
                    addNotification(`âš ï¸ åš´é‡è¶…è²·ï¼K å€¼é”åˆ° ${kValue}`, timeStr);
                } else if (kValue > 80) {
                    addNotification(`âš¡ è­¦å‘Šï¼šK å€¼è¶…é 80ï¼Œç•¶å‰ç‚º ${kValue}`, timeStr);
                } else if (kValue <= 15) {
                    addNotification(`âš ï¸ åš´é‡è¶…è³£ï¼K å€¼é™è‡³ ${kValue}`, timeStr);
                } else if (kValue < 20) {
                    addNotification(`âš¡ è­¦å‘Šï¼šK å€¼ä½æ–¼ 20ï¼Œç•¶å‰ç‚º ${kValue}`, timeStr);
                }
            };

            const addNotification = (message, time) => {
                const newNotification = { id: Date.now(), message, time };
                setNotifications(prev => [newNotification, ...prev].slice(0, 5));
                
                if ('Notification' in window && Notification.permission === 'granted') {
                    new Notification('å°è‚¡ K å€¼è­¦å ±', { body: message, icon: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><rect fill="%232563eb" width="100" height="100"/><text y="70" x="50" text-anchor="middle" font-size="60" fill="white">ğŸ“Š</text></svg>' });
                }
            };

            const requestNotificationPermission = async () => {
                if ('Notification' in window && Notification.permission !== 'granted') {
                    const permission = await Notification.requestPermission();
                    if (permission === 'granted') {
                        addNotification('âœ… é€šçŸ¥æ¬Šé™å·²é–‹å•Ÿï¼', new Date().toLocaleTimeString('zh-TW'));
                    }
                }
            };

            useEffect(() => {
                fetchDataAndCalculateK();
                const interval = setInterval(fetchDataAndCalculateK, 5 * 60 * 1000);
                return () => clearInterval(interval);
            }, []);

            useEffect(() => {
                const checkMarketTime = () => {
                    const now = new Date();
                    const hours = now.getHours();
                    const minutes = now.getMinutes();
                    if ((hours === 9 && minutes === 0) || (hours === 13 && minutes === 30)) {
                        fetchDataAndCalculateK();
                    }
                };
                const interval = setInterval(checkMarketTime, 60000);
                return () => clearInterval(interval);
            }, []);

            const getKColor = (k) => {
                if (k >= 85 || k <= 15) return 'text-red-600';
                if (k > 80 || k < 20) return 'text-orange-500';
                return 'text-green-600';
            };

            const getKStatus = (k) => {
                if (k >= 85) return 'åš´é‡è¶…è²·';
                if (k > 80) return 'è¶…è²·è­¦å‘Š';
                if (k <= 15) return 'åš´é‡è¶…è³£';
                if (k < 20) return 'è¶…è³£è­¦å‘Š';
                return 'æ­£å¸¸ç¯„åœ';
            };

            if (loading && historicalData.length === 0) {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4">
                        <div className="text-center">
                            <div className="w-16 h-16 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>
                            <p className="text-gray-700 text-lg font-medium">æ­£åœ¨è¼‰å…¥å°è‚¡æ•¸æ“š...</p>
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4 pb-24">
                    <div className="max-w-4xl mx-auto">
                        
                        {isIOS && showInstallPrompt && (
                            <div className="bg-gradient-to-r from-blue-600 to-blue-700 text-white rounded-xl shadow-2xl p-5 mb-6 relative">
                                <button 
                                    onClick={() => setShowInstallPrompt(false)}
                                    className="absolute top-3 right-3 text-white/80 hover:text-white text-2xl leading-none"
                                >Ã—</button>
                                <div className="flex items-start gap-4">
                                    <div className="text-4xl">ğŸ“±</div>
                                    <div className="flex-1">
                                        <h3 className="font-bold text-lg mb-2">å®‰è£åˆ°ä¸»ç•«é¢</h3>
                                        <p className="text-sm text-blue-100 mb-3">ç²å¾—æ›´å¥½çš„ä½¿ç”¨é«”é©—ï¼š</p>
                                        <ol className="text-sm space-y-2 text-blue-50">
                                            <li className="flex items-center gap-2">
                                                <span className="bg-white/20 rounded-full w-6 h-6 flex items-center justify-center text-xs">1</span>
                                                é»æ“Šä¸‹æ–¹ <svg className="inline w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92 1.61 0 2.92-1.31 2.92-2.92s-1.31-2.92-2.92-2.92z"/></svg> åˆ†äº«æŒ‰éˆ•
                                            </li>
                                            <li className="flex items-center gap-2">
                                                <span className="bg-white/20 rounded-full w-6 h-6 flex items-center justify-center text-xs">2</span>
                                                é¸æ“‡ã€ŒåŠ å…¥ä¸»ç•«é¢ã€
                                            </li>
                                            <li className="flex items-center gap-2">
                                                <span className="bg-white/20 rounded-full w-6 h-6 flex items-center justify-center text-xs">3</span>
                                                é»æ“Šå³ä¸Šè§’ã€Œæ–°å¢ã€
                                            </li>
                                        </ol>
                                    </div>
                                </div>
                            </div>
                        )}

                        {Notification.permission === 'default' && (
                            <div className="bg-yellow-50 border-l-4 border-yellow-400 rounded-lg p-4 mb-6 shadow-md">
                                <div className="flex items-center justify-between">
                                    <div className="flex items-center gap-3 flex-1">
                                        <div className="text-2xl">ğŸ””</div>
                                        <div>
                                            <p className="text-sm font-semibold text-gray-800">é–‹å•Ÿé€šçŸ¥æé†’</p>
                                            <p className="text-xs text-gray-600">K å€¼è¶…æ¨™æ™‚å³æ™‚æ¥æ”¶è­¦å ±</p>
                                        </div>
                                    </div>
                                    <button
                                        onClick={requestNotificationPermission}
                                        className="px-4 py-2 bg-yellow-500 text-white rounded-lg text-sm font-bold hover:bg-yellow-600 transition shadow-md"
                                    >
                                        å•Ÿç”¨
                                    </button>
                                </div>
                            </div>
                        )}

                        <div className="bg-white rounded-xl shadow-xl p-6 mb-6">
                            <div className="flex items-center justify-between mb-3">
                                <h1 className="text-3xl font-bold text-gray-800 flex items-center gap-2">
                                    <span className="text-4xl">ğŸ“ˆ</span>
                                    å°è‚¡ K å€¼ç›£æ§
                                </h1>
                                <button
                                    onClick={fetchDataAndCalculateK}
                                    disabled={loading}
                                    className="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition shadow-md disabled:opacity-50"
                                >
                                    {loading ? 'æ›´æ–°ä¸­...' : 'ğŸ”„ æ›´æ–°'}
                                </button>
                            </div>
                            <div className="flex flex-wrap items-center gap-x-4 gap-y-2 text-sm text-gray-500">
                                <span>â° {lastUpdate.toLocaleTimeString('zh-TW')}</span>
                                <span>ğŸ“Š {dataSource}</span>
                            </div>
                        </div>

                        <div className="bg-white rounded-xl shadow-xl p-8 mb-6">
                            <div className="flex items-center gap-2 mb-6">
                                <span className="text-2xl">ğŸ“…</span>
                                <h2 className="text-xl font-semibold text-gray-700">
                                    {new Date().toLocaleDateString('zh-TW', { year: 'numeric', month: 'long', day: 'numeric' })}
                                </h2>
                            </div>
                            
                            <div className="text-center mb-8">
                                <div className={`text-8xl font-bold mb-3 ${getKColor(currentK)}`}>
                                    {currentK !== null ? currentK : '--'}
                                </div>
                                <div className={`text-3xl font-semibold mb-4 ${getKColor(currentK)}`}>
                                    {currentK !== null ? getKStatus(currentK) : 'è¼‰å…¥ä¸­...'}
                                </div>
                                {historicalData.length > 0 && (
                                    <div className="text-gray-600 text-lg">
                                        åŠ æ¬ŠæŒ‡æ•¸ï¼š{historicalData[historicalData.length - 1].price.toLocaleString()} é»
                                    </div>
                                )}
                            </div>

                            <div className="grid grid-cols-2 sm:grid-cols-4 gap-3">
                                <div className="p-4 bg-red-50 rounded-xl text-center border-2 border-red-100">
                                    <div className="text-xs text-gray-600 mb-1">åš´é‡è¶…è²·</div>
                                    <div className="text-2xl font-bold text-red-600">â‰¥ 85</div>
                                </div>
                                <div className="p-4 bg-orange-50 rounded-xl text-center border-2 border-orange-100">
                                    <div className="text-xs text-gray-600 mb-1">è¶…è²·è­¦å‘Š</div>
                                    <div className="text-2xl font-bold text-orange-500">&gt; 80</div>
                                </div>
                                <div className="p-4 bg-orange-50 rounded-xl text-center border-2 border-orange-100">
                                    <div className="text-xs text-gray-600 mb-1">è¶…è³£è­¦å‘Š</div>
                                    <div className="text-2xl font-bold text-orange-500">&lt; 20</div>
                                </div>
                                <div className="p-4 bg-red-50 rounded-xl text-center border-2 border-red-100">
                                    <div className="text-xs text-gray-600 mb-1">åš´é‡è¶…è³£</div>
                                    <div className="text-2xl font-bold text-red-600">â‰¤ 15</div>
                                </div>
                            </div>
                        </div>

                        <div className="bg-white rounded-xl shadow-xl p-6 mb-6">
                            <h2 className="text-xl font-semibold text-gray-700 mb-4 flex items-center gap-2">
                                <span className="text-2xl">ğŸ“‰</span>
                                è¿‘ 10 æ—¥ K å€¼èµ°å‹¢
                            </h2>
                            <ResponsiveContainer width="100%" height={280}>
                                <LineChart data={historicalData} margin={{ top: 5, right: 5, left: -20, bottom: 5 }}>
                                    <CartesianGrid strokeDasharray="3 3" stroke="#e5e7eb" />
                                    <XAxis dataKey="date" style={{ fontSize: '11px' }} stroke="#6b7280" />
                                    <YAxis domain={[0, 100]} style={{ fontSize: '11px' }} stroke="#6b7280" />
                                    <Tooltip 
                                        contentStyle={{ backgroundColor: '#fff', border: '1px solid #e5e7eb', borderRadius: '8px' }}
                                        formatter={(value) => [`K å€¼: ${value}`, '']}
                                    />
                                    <ReferenceLine y={80} stroke="#f59e0b" strokeDasharray="5 5" strokeWidth={1.5} />
                                    <ReferenceLine y={85} stroke="#dc2626" strokeDasharray="5 5" strokeWidth={1.5} />
                                    <ReferenceLine y={20} stroke="#f59e0b" strokeDasharray="5 5" strokeWidth={1.5} />
                                    <ReferenceLine y={15} stroke="#dc2626" strokeDasharray="5 5" strokeWidth={1.5} />
                                    <Line 
                                        type="monotone" 
                                        dataKey="kValue" 
                                        stroke="#2563eb" 
                                        strokeWidth={3}
                                        dot={{ fill: '#2563eb', r: 4 }}
                                        activeDot={{ r: 6 }}
                                    />
                                </LineChart>
                            </ResponsiveContainer>
                        </div>

                        {notifications.length > 0 && (
                            <div className="bg-white rounded-xl shadow-xl p-6 mb-6">
                                <h2 className="text-xl font-semibold text-gray-700 mb-4 flex items-center gap-2">
                                    <span className="text-2xl">ğŸ””</span>
                                    é€šçŸ¥è¨˜éŒ„
                                </h2>
                                <div className="space-y-3">
                                    {notifications.map(notif => (
                                        <div key={notif.id} className="p-4 bg-yellow-50 border-l-4 border-yellow-400 rounded-lg shadow-sm">
                                            <div className="flex justify-between items-start gap-3">
                                                <span className="text-gray-800 flex-1">{notif.message}</span>
                                                <span className="text-xs text-gray-500 whitespace-nowrap">{notif.time}</span>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}

                        <div className="bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl p-6 text-center text-sm text-gray-700 border border-blue-100">
                            <p className="mb-3 font-semibold text-base">ğŸ“ K å€¼è¨ˆç®—å…¬å¼</p>
                            <p className="mb-2">RSV = (æ”¶ç›¤åƒ¹ - è¿‘9æ—¥æœ€ä½åƒ¹) Ã· (è¿‘9æ—¥æœ€é«˜åƒ¹ - è¿‘9æ—¥æœ€ä½åƒ¹) Ã— 100</p>
                            <p className="mb-4">K å€¼ = å‰æ—¥ K å€¼ Ã— 2/3 + ç•¶æ—¥ RSV Ã— 1/3</p>
                            <div className="border-t border-blue-200 pt-4 mt-4">
                                <p className="font-semibold mb-2">â° è‡ªå‹•æª¢æŸ¥æ™‚é–“</p>
                                <p className="text-xs">ç¬¦åˆæ¢ä»¶ç«‹å³é€šçŸ¥ â€¢ é–‹ç›¤ 09:00 â€¢ æ”¶ç›¤ 13:30</p>
                                <p className="text-xs mt-2 text-gray-500">æ¯ 5 åˆ†é˜è‡ªå‹•æ›´æ–°æ•¸æ“š</p>
                            </div>
                        </div>

                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
